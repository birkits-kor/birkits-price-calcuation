<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë²„í‚·ì¸ (birkits) ìŠ¤ë§ˆíŠ¸ ê²¬ì ì„œ</title>
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root { --brand-color: #1a1a1a; --point-color: #3498db; --bg-color: #f2f4f7; --sale-color: #e67e22; }
        body { font-family: -apple-system, sans-serif; background-color: var(--bg-color); margin: 0; padding: 0; color: #333; -webkit-tap-highlight-color: transparent; }
        
        .header { background: white; padding: 20px; text-align: center; border-bottom: 1px solid #eee; position: sticky; top: 0; z-index: 100; }
        .logo { font-size: 1.6rem; font-weight: 900; margin: 0; color: var(--brand-color); }
        .sub-logo { font-size: 0.85rem; color: #666; margin-top: 4px; font-weight: bold; }
        .content { padding: 20px; padding-bottom: 200px; max-width: 500px; margin: 0 auto; }
        
        .lineup-tabs { display: flex; gap: 8px; margin-bottom: 20px; }
        .tab-btn { flex: 1; padding: 14px; border: 2px solid #ddd; border-radius: 12px; background: white; font-weight: bold; cursor: pointer; transition:0.2s; }
        .tab-btn.active { border-color: var(--brand-color); background: var(--brand-color); color: white; }
        
        .section-title { font-size: 1rem; font-weight: 800; margin: 25px 0 10px 5px; color: var(--brand-color); border-left: 4px solid var(--point-color); padding-left: 10px; }
        
        .select-trigger { width: 100%; padding: 16px; background: white; border: 1px solid #e0e0e0; border-radius: 15px; text-align: left; margin-bottom: 8px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: 600; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .trigger-set { border: 2px solid var(--sale-color); color: var(--sale-color); background: #fffaf0; }
        
        .item-row { background: #fff; padding: 18px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: start; box-shadow: 0 2px 8px rgba(0,0,0,0.05); position: relative; }
        .brand-tag { font-size: 0.65rem; font-weight: 800; padding: 3px 6px; border-radius: 4px; margin-bottom: 6px; display: inline-block; }
        .tag-ma { background: #e8f4fd; color: #2980b9; }
        .tag-shuv { background: #fef9e7; color: #f39c12; }
        .set-desc { font-size: 0.75rem; color: #7f8c8d; margin-top: 5px; display: block; background: #f8f9fa; padding: 6px; border-radius: 6px; line-height: 1.3; }
        
        .price-group { margin-top: 5px; }
        .price-origin { text-decoration: line-through; color: #bbb; font-size: 0.8rem; margin-right: 5px; }
        .price-selling { color: #555; font-size: 0.85rem; font-weight: 600; margin-right: 5px; }
        .price-final { color: var(--sale-color); font-size: 1.05rem; font-weight: 900; display: block; margin-top: 2px; }
        .discount-badge { background: var(--sale-color); color: white; padding: 3px 8px; border-radius: 10px; font-size: 0.7rem; font-weight: bold; margin-left: auto; }

        .info-card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-top: 10px; }
        .input-group { margin-bottom: 12px; }
        .input-group label { display: block; font-size: 0.8rem; color: #777; margin-bottom: 5px; font-weight: 600; }
        input, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 0.95rem; background: #fff; }
        .addr-btn { background: var(--brand-color); color: white; border: none; padding: 12px; border-radius: 10px; font-size: 0.85rem; cursor: pointer; width: 80px; }

        .bottom-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding: 20px; border-top: 1px solid #eee; z-index: 1000; box-shadow: 0 -5px 15px rgba(0,0,0,0.05); box-sizing: border-box; }
        .action-group { display: flex; gap: 10px; margin-top: 15px; }
        .btn-action { flex: 1; padding: 15px; border-radius: 12px; font-weight: bold; border: none; color: white; background: var(--sale-color); font-size: 0.95rem; cursor: pointer; }
        .btn-secondary { background: #34495e; }

        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; align-items: flex-end; }
        .modal-content { width: 100%; background: white; border-radius: 25px 25px 0 0; max-height: 85%; overflow-y: auto; padding: 20px; box-sizing: border-box; }
        .option-item { padding: 18px 0; border-bottom: 1px solid #f5f5f5; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .step-indicator { font-size: 0.85rem; color: var(--point-color); font-weight: bold; margin-bottom: 8px; display: block; }
        
        #receipt-temp { position: fixed; top: -9999px; left: -9999px; width: 380px; background: white; padding: 30px; border: 1px solid #eee; color: #333; }
        .receipt-h { border-bottom: 2px solid #333; padding-bottom: 15px; margin-bottom: 20px; text-align: center; }
        .receipt-line { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 12px; align-items: flex-start; }
    </style>
</head>
<body>

<div class="header">
    <h1 class="logo">birkits</h1>
    <div class="sub-logo">ë²„í‚·ì¸  ìŠ¤ë§ˆíŠ¸ ê²¬ì ì„œ</div>
</div>

<div class="content">
    <div class="lineup-tabs">
        <button class="tab-btn active" id="tab-ma" onclick="switchLineup('ma')">Ma bed (ë§ˆë² ë“œ)</button>
        <button class="tab-btn" id="tab-shuv" onclick="switchLineup('shuv')">shuv (ìŠˆë¸Œ)</button>
    </div>

    <div class="section-title">ì œí’ˆ ê²¬ì  ì„ íƒ</div>
    <button class="select-trigger trigger-set" onclick="openSetModal()">â­ ì„¸íŠ¸ ìƒí’ˆ ì„ íƒ (ì¶”ê°€í• ì¸ ì ìš©) <span>+</span></button>
    <button class="select-trigger" onclick="openFrameModal()">ë‹¨í’ˆ: í”„ë ˆì„ <span>+</span></button>
    <button class="select-trigger" id="fabricBtn" style="display:none;" onclick="openModal('fabrics')">íŒ¨ë¸Œë¦­ ì»¬ëŸ¬ (ìŠˆë¸Œ ì „ìš©) <span>+</span></button>
    <button class="select-trigger" onclick="openModal('mattresses')">ë‹¨í’ˆ: ë§¤íŠ¸ë¦¬ìŠ¤ <span>+</span></button>
    <button class="select-trigger" onclick="openModal('heads')">ë‹¨í’ˆ: í—¤ë“œ / í˜‘íƒ íŒ¨í‚¤ì§€ <span>+</span></button>
    <button class="select-trigger" onclick="openModal('tables')">ë‹¨í’ˆ: í…Œì´ë¸” <span>+</span></button>
    <button class="select-trigger" onclick="openModal('lights')">ë‹¨í’ˆ: ë¬´ë“œë“± <span>+</span></button>
    <button class="select-trigger" onclick="openModal('delivery')">ë°°ì†¡ë¹„ ì¶”ê°€ (ìˆ˜ë„ê¶Œ ì™¸) <span>+</span></button>

    <div id="itemList"></div>

    <div class="section-title">ë°°ì†¡ ì •ë³´ (ì„ íƒ)</div>
    <div class="info-card">
        <div class="input-group"><label>ì„±í•¨</label><input type="text" id="custName" placeholder="ê³ ê°ëª…"></div>
        <div class="input-group"><label>ì—°ë½ì²˜</label><input type="tel" id="custPhone" placeholder="010-0000-0000"></div>
        <div class="input-group">
            <label>ë°°ì†¡ì§€ ì£¼ì†Œ</label>
            <div style="display:flex; gap:5px; margin-bottom:5px;">
                <input type="text" id="custAddr" placeholder="ì£¼ì†Œ ê²€ìƒ‰">
                <button class="addr-btn" onclick="execPostcode()">ê²€ìƒ‰</button>
            </div>
            <input type="text" id="custAddrDetail" placeholder="ìƒì„¸ ì£¼ì†Œ ì…ë ¥">
        </div>
        <div class="input-group"><label>ìš”ì²­ì‚¬í•­</label><textarea id="custMsg" rows="2" placeholder="ë°°ì†¡ ìš”ì²­ì‚¬í•­ ë“±"></textarea></div>
    </div>
</div>

<div class="bottom-bar">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <span style="font-weight:bold; font-size:1.1rem;">ì´ ê²¬ì  ê¸ˆì•¡</span>
        <span style="font-size:1.6rem; font-weight:900; color:var(--sale-color);"><span id="totalDisplay">0</span>ì›</span>
    </div>
    <div class="action-group">
        <button class="btn-action btn-secondary" onclick="copyText()">í…ìŠ¤íŠ¸ ë³µì‚¬</button>
        <button class="btn-action" onclick="downloadImage()">ì´ë¯¸ì§€ ì €ì¥</button>
    </div>
</div>

<div id="receipt-temp"></div>

<div class="modal-overlay" id="modalOverlay" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <span class="step-indicator" id="stepIndicator"></span>
        <h3 id="modalTitle" style="margin:0 0 20px 0; border-bottom:1px solid #eee; padding-bottom:15px;">ì˜µì…˜ ì„ íƒ</h3>
        <div id="optionList"></div>
    </div>
</div>

<script>
let currentLineup = 'ma';
let selectedItems = [];

// ë°°ì†¡ë¹„ ë°ì´í„° (ì‹œíŠ¸ ë°˜ì˜)
const deliveryData = [
    {n:"ë°°ì†¡ë¹„ (ì¶©ì²­/ê°•í™”ë„/ì˜ì¢…ë„/ë™ë‘ì²œ/í¬ì²œ/ì—°ì²œ)", p:30000},
    {n:"ë°°ì†¡ë¹„ (ê°•ì›/ê²½ìƒ/ì „ë¼)", p:47500},
    {n:"ì œì£¼ íƒë°°ë°°ì†¡ (ê³ ê°ì§ì ‘ì¡°ë¦½)", p:0}
];

// ë‹¨í’ˆ ë§¤íŠ¸ë¦¬ìŠ¤ (íŒë§¤ê°€ëŠ” ì‹œíŠ¸, ì •ìƒê°€ëŠ” ì„ì˜)
const mattressData = [
    {n:"S í•˜ë“œ", op:1100000, p:553500}, {n:"S ë¯¸ë””ì›€ í•˜ë“œ", op:1100000, p:465500},
    {n:"SS í•˜ë“œ", op:1200000, p:573500}, {n:"SS ë¯¸ë””ì›€ í•˜ë“œ", op:1200000, p:485500},
    {n:"Q í•˜ë“œ", op:1500000, p:611500}, {n:"Q ë¯¸ë””ì›€ í•˜ë“œ", op:1500000, p:545500},
    {n:"S+S ì»¤í”Œ í•˜ë“œ", op:2200000, p:1107000}, {n:"S+S ì»¤í”Œ MH", op:2200000, p:931000},
    {n:"SS+SS ì»¤í”Œ í•˜ë“œ", op:2400000, p:1147000}, {n:"SS+SS ì»¤í”Œ MH", op:2400000, p:971000}
];

const data = {
    ma: {
        frames: [
            {n:"SS í”„ë ˆì„ (ê·¸ë ˆì´)", op:2500000, p:1089000}, {n:"SS í”„ë ˆì„ (ë‚´ì¶”ëŸ´)", op:2500000, p:1089000}, {n:"SS í”„ë ˆì„ (í™”ì´íŠ¸)", op:2500000, p:1089000},
            {n:"Q í”„ë ˆì„ (ê·¸ë ˆì´)", op:2800000, p:1289000}, {n:"Q í”„ë ˆì„ (ë‚´ì¶”ëŸ´)", op:2800000, p:1289000}, {n:"Q í”„ë ˆì„ (í™”ì´íŠ¸)", op:2800000, p:1289000},
            {n:"S í”„ë ˆì„ (ê·¸ë ˆì´)", op:2400000, p:989000}, {n:"S í”„ë ˆì„ (ë‚´ì¶”ëŸ´)", op:2400000, p:989000}, {n:"S í”„ë ˆì„ (í™”ì´íŠ¸)", op:2400000, p:989000},
            {n:"S+S í”„ë ˆì„ (ê·¸ë ˆì´)", op:4800000, p:1978000}, {n:"S+S í”„ë ˆì„ (ë‚´ì¶”ëŸ´)", op:4800000, p:1978000}, {n:"S+S í”„ë ˆì„ (í™”ì´íŠ¸)", op:4800000, p:1978000},
            {n:"SS+SS í”„ë ˆì„ (ê·¸ë ˆì´)", op:5000000, p:2178000}, {n:"SS+SS í”„ë ˆì„ (ë‚´ì¶”ëŸ´)", op:5000000, p:2178000}, {n:"SS+SS í”„ë ˆì„ (í™”ì´íŠ¸)", op:5000000, p:2178000}
        ],
        fabrics: [],
        heads: [
            {n:"SS í—¤ë“œ ë‹¨í’ˆ", op:400000, p:160000}, {n:"SS í—¤ë“œ+í˜‘íƒ1", op:800000, p:340000}, {n:"SS í—¤ë“œ+í˜‘íƒ2", op:1200000, p:520000},
            {n:"Q í—¤ë“œ ë‹¨í’ˆ", op:500000, p:200000}, {n:"Q í—¤ë“œ+í˜‘íƒ1", op:900000, p:380000}, {n:"Q í—¤ë“œ+í˜‘íƒ2", op:1300000, p:560000},
            {n:"S í—¤ë“œ ë‹¨í’ˆ", op:350000, p:140000}, {n:"S í—¤ë“œ+í˜‘íƒ1", op:700000, p:320000}, {n:"S í—¤ë“œ+í˜‘íƒ2", op:1050000, p:500000},
            {n:"S+S í—¤ë“œ ë‹¨í’ˆ", op:700000, p:280000}, {n:"S+S í—¤ë“œ+í˜‘íƒ1", op:1100000, p:460000}, {n:"S+S í—¤ë“œ+í˜‘íƒ2", op:1500000, p:640000},
            {n:"SS+SS í—¤ë“œ ë‹¨í’ˆ", op:800000, p:320000}, {n:"SS+SS í—¤ë“œ+í˜‘íƒ1", op:1200000, p:500000}, {n:"SS+SS í—¤ë“œ+í˜‘íƒ2", op:1600000, p:680000}
        ],
        tables: [
            {n:"SS ìˆ˜ë™ í…Œì´ë¸”", op:400000, p:180000}, {n:"SS ìë™ í…Œì´ë¸”", op:800000, p:340000},
            {n:"Q ìˆ˜ë™ í…Œì´ë¸”", op:500000, p:240000}, {n:"Q ìë™ í…Œì´ë¸”", op:900000, p:400000},
            {n:"S+S ìˆ˜ë™ í…Œì´ë¸”", op:700000, p:300000}, {n:"S+S ìë™ í…Œì´ë¸”", op:1100000, p:460000}
        ],
        sets: {
            "ğŸŒ™ ì—ì„¼ì…œ ìŠ¬ë¦½": { d: 2, o: "í”„ë ˆì„ + ë§¤íŠ¸ë¦¬ìŠ¤ + í—¤ë“œ", sizes: { 
                "SS": [3233500, 1822500, 1786000, 1699760], 
                "Q": [3611500, 2100500, 2058000, 1993320],
                "S+S": [6187000, 3365000, 3298000, 3125520],
                "SS+SS": [6467000, 3645000, 3572000, 3399520]
            } },
            "ğŸ’« ë¡œë§¨í‹± ìŠ¬ë¦½": { d: 3, o: "í”„ë ˆì„ + ë§¤íŠ¸ë¦¬ìŠ¤ + í—¤ë“œ + í˜‘íƒ(ì–‘ìª½)", sizes: { 
                "SS": [3593500, 2182500, 2117000, 2031640], 
                "Q": [3971500, 2460500, 2387000, 2322980], 
                "S+S": [6547000, 3725000, 3613000, 3442280], 
                "SS+SS": [6827000, 4005000, 3885000, 3714280] 
            } },
            "ğŸ“š ë¶ìŠ¬ë¦½ ì„¸íŠ¸": { d: 3, o: "í”„ë ˆì„ + ë§¤íŠ¸ë¦¬ìŠ¤ + ìë™ í…Œì´ë¸”", sizes: { 
                "SS": [3413500, 2002500, 1942000, 1856640], 
                "Q": [3811500, 2300500, 2231000, 2166980], 
                "S+S": [6367000, 3545000, 3439000, 3268280] 
            } },
            "ğŸŒŸ í’€ìŠ¬ë¦½ ì„¸íŠ¸": { d: 5, o: "í”„ë ˆì„+ë§¤íŠ¸ë¦¬ìŠ¤+í—¤ë“œ+í˜‘íƒ+ìë™í…Œì´ë¸”+ë¬´ë“œë“±", sizes: { 
                "SS": [4003500, 2592500, 2463000, 2379400], 
                "Q": [4441500, 2930500, 2784000, 2721300], 
                "S+S": [7077000, 4255000, 4042000, 3874800] 
            } },
            "ğŸ’‘ ìœ„ë“œìŠ¬ë¦½ ì„¸íŠ¸": { d: 5, o: "ì»¤í”Œí”„ë ˆì„2+ë§¤íŠ¸ë¦¬ìŠ¤2+í—¤ë“œ2+í˜‘íƒ+ë¬´ë“œë“±", sizes: { 
                "S+S": [6617000, 3795000, 3605000, 3437800], 
                "SS+SS": [6897000, 4075000, 3871000, 3703800] 
            } }
        }
    },
    shuv: {
        frames: [
            {n:"SS í”„ë ˆì„ (ë³´ì—ë¥´ Fog)", op:4000000, p:1509000},
            {n:"Q í”„ë ˆì„ (ë³´ì—ë¥´ Fog)", op:4500000, p:1809000},
            {n:"S í”„ë ˆì„ (ë³´ì—ë¥´ Fog)", op:3750000, p:1409000},
            {n:"S+S í”„ë ˆì„ (ë³´ì—ë¥´ Fog)", op:7500000, p:2818000},
            {n:"SS+SS í”„ë ˆì„ (ë³´ì—ë¥´ Fog)", op:8000000, p:3018000}
        ],
        fabrics: [
            {n:"ë³´ì—ë¥´ - Fog(ì•„ì´ë³´ë¦¬)", op:0, p:0},
            {n:"ë³´ì—ë¥´ - Moonstone(ê·¸ë ˆì´)", op:0, p:0},
            {n:"ë³´ì—ë¥´ - Shadow(ë¸”ë™)", op:0, p:0},
            {n:"ë³´ì—ë¥´ - Forest(ê·¸ë¦°)", op:0, p:0},
            {n:"ë³´ì—ë¥´ - RosÃ©(í•‘í¬)", op:0, p:0},
            {n:"ë³´ì—ë¥´ - Aqua(ë¼ì´íŠ¸ë¸”ë£¨)", op:0, p:0},
            {n:"ë³´ì—ë¥´ - Sand(ë² ì´ì§€)", op:0, p:0},
            {n:"ìŠ¤ì›¨ë¦° Suerin (ìƒë‹´)", op:0, p:200000},
            {n:"ê³ ë ˆë” GoLeatherâ„¢ - í™”ì´íŠ¸", op:0, p:200000},
            {n:"ê³ ë ˆë” GoLeatherâ„¢ - ë¸”ë™", op:0, p:200000},
            {n:"ë©œë¡œë£¨í”„ - Knowing Black", op:0, p:100000},
            {n:"ë©œë¡œë£¨í”„ - Taupe Coffee", op:0, p:100000},
            {n:"ë©œë¡œë£¨í”„ - Lamb Milk", op:0, p:100000},
            {n:"ë¦¬ë…¸ì•„ - Sand", op:0, p:100000},
            {n:"ë¦¬ë…¸ì•„ - Cream", op:0, p:100000}
        ],
        heads: [
            {n:"SS íŒ¨ë¸Œë¦­ í—¤ë“œ", op:800000, p:280000}, {n:"SS í—¤ë“œ+í˜‘íƒ1", op:1400000, p:600000}, {n:"SS í—¤ë“œ+í˜‘íƒ2", op:2000000, p:920000},
            {n:"Q íŒ¨ë¸Œë¦­ í—¤ë“œ", op:1000000, p:320000}, {n:"Q í—¤ë“œ+í˜‘íƒ1", op:1800000, p:740000}, {n:"Q í—¤ë“œ+í˜‘íƒ2", op:2600000, p:1060000},
            {n:"S íŒ¨ë¸Œë¦­ í—¤ë“œ", op:700000, p:240000}, {n:"S í—¤ë“œ+í˜‘íƒ1", op:1300000, p:560000}, {n:"S í—¤ë“œ+í˜‘íƒ2", op:1900000, p:880000},
            {n:"S+S ì»¤í”Œ í—¤ë“œ", op:1400000, p:480000}, {n:"S+S í—¤ë“œ+í˜‘íƒ1", op:2000000, p:800000}, {n:"S+S í—¤ë“œ+í˜‘íƒ2", op:2600000, p:1120000},
            {n:"SS+SS ì»¤í”Œ í—¤ë“œ", op:1600000, p:560000}, {n:"SS+SS í—¤ë“œ+í˜‘íƒ1", op:2200000, p:880000}, {n:"SS+SS í—¤ë“œ+í˜‘íƒ2", op:2800000, p:1200000}
        ],
        tables: [
            {n:"SS íŒ¨ë¸Œë¦­ í…Œì´ë¸”", op:700000, p:320000}, 
            {n:"Q íŒ¨ë¸Œë¦­ í…Œì´ë¸”", op:800000, p:360000},
            {n:"S+S íŒ¨ë¸Œë¦­ í…Œì´ë¸”", op:1000000, p:400000}
        ],
        sets: {
            "ğŸŒ™ ì—ì„¼ì…œ ìŠ¬ë¦½": { d: 2, o: "ìŠˆë¸Œ í”„ë ˆì„ + ë§¤íŠ¸ë¦¬ìŠ¤ + í—¤ë“œ (Fog)", sizes: { 
                "SS": [4853500, 2362500, 2315000, 2228760], 
                "Q": [5431500, 2740500, 2686000, 2621320],
                "S+S": [9087000, 4405000, 4317000, 4144520],
                "SS+SS": [9707000, 4725000, 4631000, 4458520]
            } },
            "ğŸ’« ë¡œë§¨í‹± ìŠ¬ë¦½": { d: 3, o: "í”„ë ˆì„ + ë§¤íŠ¸ë¦¬ìŠ¤ + í—¤ë“œ + í˜‘íƒ(ì–‘ìª½)", sizes: { 
                "SS": [5493500, 3002500, 2912000, 2826640], 
                "Q": [6071500, 3380500, 3279000, 3214980], 
                "S+S": [9727000, 5045000, 4894000, 4723280], 
                "SS+SS": [10347000, 5365000, 5033280, 5033280] // ì‹œíŠ¸ìƒ MHê°€ê²© ë™ì¼
            } },
            "ğŸ“š ë¶ìŠ¬ë¦½ ì„¸íŠ¸": { d: 3, o: "í”„ë ˆì„ + ë§¤íŠ¸ë¦¬ìŠ¤ + í…Œì´ë¸”", sizes: { 
                "SS": [4893500, 2402500, 2330000, 2244640], 
                "Q": [5471500, 2780500, 2697000, 2632980], 
                "S+S": [9007000, 4325000, 4195000, 4024280] 
            } },
            "ğŸŒŸ í’€ìŠ¬ë¦½ ì„¸íŠ¸": { d: 5, o: "í”„ë ˆì„+ë§¤íŠ¸ë¦¬ìŠ¤+í—¤ë“œ+í˜‘íƒ+í…Œì´ë¸”+ë¬´ë“œë“±", sizes: { 
                "SS": [5883500, 3392500, 3223000, 3139400], 
                "Q": [6501500, 3810500, 3620000, 3557300], 
                "S+S": [10197000, 5515000, 5239000, 5071800] 
            } },
            "ğŸ’‘ ìœ„ë“œìŠ¬ë¦½ ì„¸íŠ¸": { d: 5, o: "ì»¤í”Œí”„ë ˆì„2+ë§¤íŠ¸ë¦¬ìŠ¤2+í—¤ë“œ2+í˜‘íƒ+ë¬´ë“œë“±", sizes: { 
                "S+S": [9797000, 5115000, 4859000, 4691800], 
                "SS+SS": [10241000, 5259000, 4996000, 4828800] 
            } }
        }
    }
};

/* --- ê¸°ëŠ¥ êµ¬í˜„ë¶€ --- */

function switchLineup(l) { 
    currentLineup = l; 
    document.getElementById('tab-ma').classList.toggle('active', l === 'ma'); 
    document.getElementById('tab-shuv').classList.toggle('active', l === 'shuv');
    document.getElementById('fabricBtn').style.display = l === 'shuv' ? 'flex' : 'none';
}

function execPostcode() { 
    new daum.Postcode({ oncomplete: function(d) { 
        document.getElementById('custAddr').value = d.address; 
        document.getElementById('custAddrDetail').focus(); 
    }}).open(); 
}

function openFrameModal() { openModal('frames'); }

// 1ë‹¨ê³„: ì„¸íŠ¸ ì¢…ë¥˜
function openSetModal() {
    const l = document.getElementById('optionList'); 
    document.getElementById('modalTitle').innerText = "ì„¸íŠ¸ ì¢…ë¥˜ ì„ íƒ";
    document.getElementById('stepIndicator').innerText = "STEP 1/3";
    l.innerHTML = '';
    
    for (let setName in data[currentLineup].sets) {
        const set = data[currentLineup].sets[setName];
        const div = document.createElement('div'); div.className = 'option-item';
        div.onclick = () => selectSetSize(setName);
        div.innerHTML = `
            <div style="flex:1;">
                <div style="display:flex; align-items:center; gap:5px;">
                    <span style="font-weight:bold;">${setName}</span>
                    <span class="discount-badge">${set.d}% ì¶”ê°€í• ì¸</span>
                </div>
                <span class="set-desc">${set.o}</span>
            </div>
            <span style="color:#ccc;">â¯</span>
        `;
        l.appendChild(div);
    }
    document.getElementById('modalOverlay').style.display = 'flex';
}

// 2ë‹¨ê³„: ì‚¬ì´ì¦ˆ
function selectSetSize(setName) {
    const l = document.getElementById('optionList'); 
    document.getElementById('modalTitle').innerText = `${setName} - ì‚¬ì´ì¦ˆ ì„ íƒ`;
    document.getElementById('stepIndicator').innerText = "STEP 2/3";
    l.innerHTML = '';
    
    for (let size in data[currentLineup].sets[setName].sizes) {
        const div = document.createElement('div'); div.className = 'option-item';
        div.onclick = () => selectSetType(setName, size);
        div.innerHTML = `<span>${size} ì‚¬ì´ì¦ˆ</span><span style="color:#ccc;">â¯</span>`;
        l.appendChild(div);
    }
}

// 3ë‹¨ê³„: ë§¤íŠ¸ë¦¬ìŠ¤
function selectSetType(setName, size) {
    const l = document.getElementById('optionList'); 
    document.getElementById('modalTitle').innerText = "ë§¤íŠ¸ë¦¬ìŠ¤ íƒ€ì… ì„ íƒ";
    document.getElementById('stepIndicator').innerText = "STEP 3/3";
    l.innerHTML = '';
    
    const p = data[currentLineup].sets[setName].sizes[size]; // [ì •ìƒê°€, íŒë§¤ê°€, í• ì¸ê°€H, í• ì¸ê°€MH]
    const types = [{n:"í•˜ë“œ", fp:p[2]}, {n:"ë¯¸ë””ì›€ í•˜ë“œ", fp:p[3]}];
    
    types.forEach(type => {
        const div = document.createElement('div'); div.className = 'option-item';
        div.onclick = () => { 
            addItem(`${setName} ${size} (${type.n})`, type.fp, currentLineup, data[currentLineup].sets[setName].o, p[0]); 
            closeModal(); 
        };
        div.innerHTML = `
            <div style="flex:1;">
                <span style="font-weight:bold;">${type.n}</span>
                <div style="margin-top:5px;">
                    <span class="price-origin">â‚©${p[0].toLocaleString()}</span>
                    <span class="price-selling">íŒë§¤ê°€: â‚©${p[1].toLocaleString()}</span>
                    <span class="price-final">ìµœì¢…ê°€: â‚©${type.fp.toLocaleString()}ì›</span>
                </div>
            </div>
        `;
        l.appendChild(div);
    });
}

// ë‹¨í’ˆ/ì˜µì…˜ ëª¨ë‹¬
function openModal(c) {
    const l = document.getElementById('optionList'); 
    document.getElementById('modalTitle').innerText = "ì˜µì…˜ ì¶”ê°€";
    document.getElementById('stepIndicator').innerText = ""; 
    l.innerHTML = '';
    
    let opts = [];
    if(c === 'delivery') opts = deliveryData;
    else if(c === 'mattresses') opts = mattressData;
    else if(c === 'lights') opts = [{n:"ë¬´ë“œë“± í•œìª½", op:70000, p:35000}, {n:"ë¬´ë“œë“± ì–‘ìª½", op:140000, p:70000}];
    else opts = data[currentLineup][c];
    
    opts.forEach(opt => {
        const div = document.createElement('div'); div.className = 'option-item';
        div.onclick = () => { addItem(opt.n, opt.p, currentLineup, "", opt.op); closeModal(); };
        div.innerHTML = `
            <div style="flex:1;">
                <span>${opt.n}</span>
                <div style="margin-top:2px;">
                    ${opt.op > 0 ? `<span class="price-origin">â‚©${opt.op.toLocaleString()}</span>` : ''}
                    <span style="font-weight:bold; color:#555;">â‚©${opt.p.toLocaleString()}ì›</span>
                </div>
            </div>
            <span style="color:var(--point-color); font-weight:bold;">+</span>
        `;
        l.appendChild(div);
    });
    document.getElementById('modalOverlay').style.display = 'flex';
}

function closeModal() { document.getElementById('modalOverlay').style.display = 'none'; }
function addItem(n, p, b, d, op) { selectedItems.push({ id: Date.now(), name: `[${b === 'ma' ? 'ë§ˆë² ë“œ' : 'ìŠˆë¸Œ'}] ${n}`, price: p, desc: d, origin: op }); render(); }
function removeItem(id) { selectedItems = selectedItems.filter(i => i.id !== id); render(); }

function render() {
    const list = document.getElementById('itemList'); list.innerHTML = ''; let t = 0;
    selectedItems.forEach(i => { t += i.price;
        list.innerHTML += `
            <div class="item-row">
                <div style="flex:1;">
                    <span class="brand-tag ${i.name.includes('ë§ˆë² ë“œ') ? 'tag-ma' : 'tag-shuv'}">${i.name.includes('ë§ˆë² ë“œ') ? 'MA BED' : 'SHUV'}</span>
                    <strong style="display:block; margin-top:5px;">${i.name.replace(/^\[.*?\]\s*/, '')}</strong>
                    ${i.desc ? `<span class="set-desc">êµ¬ì„±: ${i.desc}</span>` : ''}
                    <div class="price-group">
                        ${i.origin > 0 ? `<span class="price-origin">â‚©${i.origin.toLocaleString()}</span>` : ''}
                        <span class="price-final">â‚©${i.price.toLocaleString()}ì›</span>
                    </div>
                </div>
                <button onclick="removeItem(${i.id})" style="border:none; background:none; font-size:1.5rem; color:#ccc; cursor:pointer;">Ã—</button>
            </div>`;
    }); document.getElementById('totalDisplay').innerText = t.toLocaleString();
}

function copyText() {
    if(!selectedItems.length) return alert("ì„ íƒëœ í’ˆëª©ì´ ì—†ìŠµë‹ˆë‹¤.");
    const s = { n: document.getElementById('custName').value, p: document.getElementById('custPhone').value, a: document.getElementById('custAddr').value + " " + document.getElementById('custAddrDetail').value, m: document.getElementById('custMsg').value };
    const items = selectedItems.map(i => `- ${i.name} ${i.desc ? `(${i.desc})` : ''} : ${i.price.toLocaleString()}ì›`).join('\n');
    const txt = `[ë²„í‚·ì¸  ê²¬ì ì„œ]\nê³ ê°ëª…: ${s.n}\nì—°ë½ì²˜: ${s.p}\nì£¼ì†Œ: ${s.a}\n\n${items}\n\nì´ í•©ê³„: ${document.getElementById('totalDisplay').innerText}ì›`;
    
    const t = document.createElement("textarea"); document.body.appendChild(t); t.value = txt; t.select(); document.execCommand('copy'); document.body.removeChild(t); 
    alert("ê²¬ì  ë‚´ì—­ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
}

async function downloadImage() {
    if(!selectedItems.length) return alert("ì„ íƒëœ í’ˆëª©ì´ ì—†ìŠµë‹ˆë‹¤.");
    const r = document.getElementById('receipt-temp');
    const s = { n: document.getElementById('custName').value, p: document.getElementById('custPhone').value, a: document.getElementById('custAddr').value + " " + document.getElementById('custAddrDetail').value };
    
    let h = `<div class="receipt-h"><strong style="font-size:22px;">birkits</strong><br><span style="font-size:12px;">ìŠ¤ë§ˆíŠ¸ ê²¬ì ì„œ</span></div><div style="margin-bottom:20px; font-size:12px; line-height:1.6; border-bottom:1px solid #eee; padding-bottom:15px;"><strong>ê³ ê°ëª…:</strong> ${s.n}<br><strong>ì—°ë½ì²˜:</strong> ${s.p}<br><strong>ì£¼ì†Œ:</strong> ${s.a}</div>`;
    selectedItems.forEach(i => { h += `<div class="receipt-line"><div style="flex:1;"><span style="font-weight:bold;">${i.name.replace(/^\[.*?\]\s*/, '')}</span>${i.desc ? `<br><span style="font-size:11px; color:#888;">${i.desc}</span>` : ''}</div><span style="font-weight:bold;">${i.price.toLocaleString()}</span></div>`; });
    h += `<div style="margin-top:20px; border-top:2px solid #333; padding-top:15px; display:flex; justify-content:space-between; font-weight:bold; font-size:18px; color:var(--sale-color);"><span>ì´ í•©ê³„</span><span>${document.getElementById('totalDisplay').innerText}ì›</span></div>`;
    r.innerHTML = h;

    try {
        const canvas = await html2canvas(r, { scale: 2 });
        const link = document.createElement('a'); link.download = 'ê²¬ì ì„œ.png'; link.href = canvas.toDataURL(); link.click();
    } catch (e) { alert("ì €ì¥ ì‹¤íŒ¨"); }
}
</script>
</body>
</html>
