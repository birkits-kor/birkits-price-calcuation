<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë²„í‚·ì¸ (birkits) ìŠ¤ë§ˆíŠ¸ ê²¬ì ì„œ</title>
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root { --brand-color: #1a1a1a; --point-color: #3498db; --bg-color: #f2f4f7; --delete-color: #ff4d4d; }
        body { font-family: -apple-system, sans-serif; background-color: var(--bg-color); margin: 0; padding: 0; color: #333; -webkit-tap-highlight-color: transparent; }
        .header { background: white; padding: 20px; text-align: center; border-bottom: 1px solid #eee; position: sticky; top: 0; z-index: 100; }
        .logo { font-size: 1.6rem; font-weight: 900; letter-spacing: -1px; margin: 0; color: var(--brand-color); }
        .sub-logo { font-size: 0.85rem; color: #666; margin-top: 4px; font-weight: bold; }
        .content { padding: 20px; padding-bottom: 180px; max-width: 500px; margin: 0 auto; }
        .section-title { font-size: 1rem; font-weight: 800; margin: 25px 0 15px 5px; color: var(--brand-color); border-left: 4px solid var(--point-color); padding-left: 10px; }
        .lineup-tabs { display: flex; gap: 8px; margin-bottom: 15px; }
        .tab-btn { flex: 1; padding: 14px; border: 2px solid #ddd; border-radius: 12px; background: white; font-weight: bold; cursor: pointer; font-size: 0.9rem; }
        .tab-btn.active { border-color: var(--brand-color); background: var(--brand-color); color: white; }
        .select-trigger { width: 100%; padding: 16px; background: white; border: 1px solid #e0e0e0; border-radius: 15px; text-align: left; font-size: 0.95rem; display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .trigger-set { border: 2px solid var(--point-color); font-weight: 800; color: var(--point-color); }
        .item-row { display: flex; justify-content: space-between; align-items: start; background: #fff; padding: 15px; border-radius: 15px; margin-bottom: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        .brand-tag { font-size: 0.65rem; font-weight: 800; padding: 2px 6px; border-radius: 4px; margin-bottom: 4px; display: inline-block; }
        .tag-ma { background: #e8f4fd; color: #2980b9; }
        .tag-shuv { background: #fef9e7; color: #f39c12; }
        .btn-delete { border: none; background: #eee; color: #999; width: 26px; height: 26px; border-radius: 50%; font-weight: bold; margin-top: 5px; }
        .info-card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-top: 10px; }
        .input-group { margin-bottom: 12px; }
        .input-group label { display: block; font-size: 0.8rem; color: #777; margin-bottom: 5px; font-weight: 600; }
        input, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 0.95rem; background: #fff; }
        .addr-btn { background: var(--brand-color); color: white; border: none; padding: 12px; border-radius: 10px; font-size: 0.85rem; cursor: pointer; width: 100px; }
        .bottom-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding: 15px 20px; box-sizing: border-box; border-top: 1px solid #eee; z-index: 1000; box-shadow: 0 -5px 10px rgba(0,0,0,0.05); }
        .total-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .total-price { font-size: 1.5rem; font-weight: 900; color: var(--point-color); }
        .action-group { display: flex; gap: 8px; }
        .btn-action { flex: 1; padding: 15px; border-radius: 12px; font-size: 0.95rem; font-weight: bold; cursor: pointer; border: none; color: white; background: var(--point-color); }
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; align-items: flex-end; }
        .modal-content { width: 100%; background: white; border-radius: 25px 25px 0 0; max-height: 85%; overflow-y: auto; padding: 20px; box-sizing: border-box;}
        .option-item { padding: 18px; border-bottom: 1px solid #f5f5f5; display: flex; justify-content: space-between; align-items: center; cursor: pointer;}
        #receipt-temp { position: fixed; top: -9999px; left: -9999px; width: 350px; background: white; padding: 30px; border: 1px solid #eee; }
        .receipt-h { border-bottom: 2px solid #333; padding-bottom: 15px; margin-bottom: 15px; text-align: center; }
        .receipt-line { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 8px; align-items: start; }
        .discount-badge { background: #ff4d4d; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; margin-left: auto; }
        .set-desc { font-size: 0.75rem; color: #888; margin-top: 4px; line-height: 1.4; }
        .step-indicator { font-size: 0.75rem; color: var(--point-color); font-weight: bold; margin-bottom: 10px; display: block; }
    </style>
</head>
<body>

<div class="header">
    <h1 class="logo">birkits</h1>
    <div class="sub-logo">ë²„í‚·ì¸  ìŠ¤ë§ˆíŠ¸ ê²¬ì ì„œ</div>
</div>

<div class="content">
    <div class="section-title">ë¼ì¸ì—… ì„ íƒ</div>
    <div class="lineup-tabs">
        <button class="tab-btn active" id="tab-ma" onclick="switchLineup('ma')">Ma bed (ë§ˆë² ë“œ)</button>
        <button class="tab-btn" id="tab-shuv" onclick="switchLineup('shuv')">shuv (ìŠˆë¸Œ)</button>
    </div>

    <div class="section-title">ì œí’ˆ ê²¬ì  ì„ íƒ</div>
    <button class="select-trigger trigger-set" onclick="openSetModal()">â­ ì„¸íŠ¸ ìƒí’ˆ ì„ íƒ (í• ì¸ ì ìš©) <span>+</span></button>
    <button class="select-trigger" onclick="openModal('frames')">ë‹¨í’ˆ: í”„ë ˆì„ <span>+</span></button>
    <button class="select-trigger" onclick="openModal('mattresses')">ë‹¨í’ˆ: ë§¤íŠ¸ë¦¬ìŠ¤ <span>+</span></button>
    <button class="select-trigger" onclick="openModal('heads')">ë‹¨í’ˆ: í—¤ë“œ/í˜‘íƒ <span>+</span></button>
    <button class="select-trigger" onclick="openModal('tables')">ë‹¨í’ˆ: í…Œì´ë¸” <span>+</span></button>
    <button class="select-trigger" onclick="openModal('lights')">ë‹¨í’ˆ: ë¬´ë“œë“± <span>+</span></button>

    <div class="selected-list" id="itemList"></div>

    <div class="section-title">ë°°ì†¡ ì •ë³´ ì…ë ¥ (ì„ íƒì‚¬í•­)</div>
    <div class="info-card">
        <div class="input-group"><label>ì„±í•¨</label><input type="text" id="custName" placeholder="ì„±í•¨"></div>
        <div class="input-group"><label>ì—°ë½ì²˜</label><input type="tel" id="custPhone" placeholder="ì—°ë½ì²˜"></div>
        <div class="input-group">
            <label>ë°°ì†¡ì§€ ì£¼ì†Œ</label>
            <div style="display:flex; gap:5px; margin-bottom:5px;">
                <input type="text" id="custAddr" placeholder="ì£¼ì†Œë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”">
                <button class="addr-btn" onclick="execPostcode()">ì£¼ì†Œ ì°¾ê¸°</button>
            </div>
            <input type="text" id="custAddrDetail" placeholder="ìƒì„¸ ì£¼ì†Œ">
        </div>
        <div class="input-group"><label>ë°°ì†¡ ìš”ì²­ì‚¬í•­</label><textarea id="custMsg" rows="2" placeholder="ìš”ì²­ì‚¬í•­"></textarea></div>
    </div>
</div>

<div class="bottom-bar">
    <div class="total-row"><span style="font-weight:bold;">ì´ ê²¬ì  ê¸ˆì•¡</span><span class="total-price"><span id="totalDisplay">0</span>ì›</span></div>
    <div class="action-group">
        <button class="btn-action" onclick="copyText()">í…ìŠ¤íŠ¸ ë³µì‚¬</button>
        <button class="btn-action" onclick="downloadImage()">ì´ë¯¸ì§€ ì €ì¥</button>
    </div>
</div>

<div id="receipt-temp"></div>

<div class="modal-overlay" id="modalOverlay" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <span class="step-indicator" id="stepIndicator"></span>
        <h3 id="modalTitle" style="margin:0 0 20px 0; border-bottom:1px solid #eee; padding-bottom:10px;">ì˜µì…˜ ì¶”ê°€</h3>
        <div id="optionList"></div>
    </div>
</div>

<script>
let currentLineup = 'ma';
let selectedItems = [];

const mattressData = [{n:"SS í•˜ë“œ", p:573500}, {n:"SS ë¯¸ë””ì›€ í•˜ë“œ", p:485500}, {n:"Q í•˜ë“œ", p:611500}, {n:"Q ë¯¸ë””ì›€ í•˜ë“œ", p:545500}, {n:"S í•˜ë“œ", p:553500}, {n:"S ë¯¸ë””ì›€ í•˜ë“œ", p:465500}, {n:"S+S ì»¤í”Œ í•˜ë“œ", p:1107000}, {n:"S+S ì»¤í”Œ ë¯¸ë””ì›€ í•˜ë“œ", p:931000}, {n:"SS+SS ì»¤í”Œ í•˜ë“œ", p:1147000}, {n:"SS+SS ì»¤í”Œ ë¯¸ë””ì›€ í•˜ë“œ", p:971000}];

const data = {
    ma: {
        frames: [{n:"SS í”„ë ˆì„", p:1089000}, {n:"Q í”„ë ˆì„", p:1289000}, {n:"S í”„ë ˆì„", p:989000}, {n:"SS+SS í”„ë ˆì„", p:2178000}, {n:"S+S í”„ë ˆì„", p:1978000}],
        heads: [{n:"SS í—¤ë“œ", p:160000}, {n:"Q í—¤ë“œ", p:200000}, {n:"S í—¤ë“œ", p:140000}, {n:"S+S ì»¤í”Œ í—¤ë“œ", p:280000}, {n:"SS+SS ì»¤í”Œ í—¤ë“œ", p:320000}, {n:"SS í—¤ë“œ+í˜‘íƒ1", p:340000}, {n:"Q í—¤ë“œ+í˜‘íƒ1", p:380000}, {n:"S í—¤ë“œ+í˜‘íƒ1", p:320000}, {n:"S+S ì»¤í”Œ í—¤ë“œ+í˜‘íƒ1", p:460000}, {n:"SS+SS ì»¤í”Œ í—¤ë“œ+í˜‘íƒ1", p:500000}, {n:"SS í—¤ë“œ+í˜‘íƒ2", p:520000}, {n:"Q í—¤ë“œ+í˜‘íƒ2", p:560000}, {n:"S í—¤ë“œ+í˜‘íƒ2", p:500000}, {n:"S+S ì»¤í”Œ í—¤ë“œ+í˜‘íƒ2", p:640000}, {n:"SS+SS ì»¤í”Œ í—¤ë“œ+í˜‘íƒ2", p:680000}],
        tables: [{n:"SS í…Œì´ë¸” ìˆ˜ë™", p:180000}, {n:"SS í…Œì´ë¸” ìë™", p:340000}, {n:"Q í…Œì´ë¸” ìˆ˜ë™", p:240000}, {n:"Q í…Œì´ë¸” ìë™", p:400000}, {n:"S+S í…Œì´ë¸” ìˆ˜ë™", p:300000}, {n:"S+S í…Œì´ë¸” ìë™", p:460000}],
        sets: {
            "ğŸŒ™ ì—ì„¼ì…œ ìŠ¬ë¦½": { d: 2, o: "í”„ë ˆì„ + ë§¤íŠ¸ë¦¬ìŠ¤", sizes: { "SS": [1629000, 1542760], "Q": [1862000, 1797320], "S+S": [3023000, 2850520], "SS+SS": [3259000, 3086520] } },
            "ğŸ’« ë¡œë§¨í‹± ìŠ¬ë¦½": { d: 3, o: "í”„ë ˆì„ + ë§¤íŠ¸ë¦¬ìŠ¤ + í—¤ë“œ + í˜‘íƒ(ì–‘ìª½)", sizes: { "SS": [2117000, 2031640], "Q": [2387000, 2322980], "S+S": [3613000, 3442280], "SS+SS": [3885000, 3714280] } },
            "ğŸ“š ë¶ìŠ¬ë¦½ ì„¸íŠ¸": { d: 3, o: "í”„ë ˆì„ + ë§¤íŠ¸ë¦¬ìŠ¤ + ìë™ í…Œì´ë¸”", sizes: { "SS": [1942000, 1856640], "Q": [2231000, 2166980], "S+S": [3439000, 3268280] } },
            "ğŸŒŸ í’€ìŠ¬ë¦½ ì„¸íŠ¸": { d: 5, o: "í”„ë ˆì„ + ë§¤íŠ¸ë¦¬ìŠ¤ + í—¤ë“œ + í˜‘íƒ + ìë™ í…Œì´ë¸” + ë¬´ë“œë“±", sizes: { "SS": [2463000, 2379400], "Q": [2784000, 2721300], "S+S": [4042000, 3874800] } },
            "ğŸ’‘ ìœ„ë“œìŠ¬ë¦½ ì„¸íŠ¸": { d: 5, o: "ì»¤í”Œ í”„ë ˆì„2 + ë§¤íŠ¸ë¦¬ìŠ¤2 + í—¤ë“œ2 + í˜‘íƒ + ë¬´ë“œë“±", sizes: { "S+S": [3605000, 3437800], "SS+SS": [3871000, 3703800] } }
        }
    },
    shuv: {
        frames: [{n:"SS í”„ë ˆì„", p:1509000}, {n:"Q í”„ë ˆì„", p:1809000}, {n:"S í”„ë ˆì„", p:1409000}, {n:"S+S í”„ë ˆì„", p:2818000}, {n:"SS+SS í”„ë ˆì„", p:3018000}],
        heads: [{n:"SS íŒ¨ë¸Œë¦­ í—¤ë“œ", p:280000}, {n:"Q íŒ¨ë¸Œë¦­ í—¤ë“œ", p:320000}, {n:"S íŒ¨ë¸Œë¦­ í—¤ë“œ", p:240000}, {n:"S+S ì»¤í”Œ í—¤ë“œ", p:480000}, {n:"SS+SS ì»¤í”Œ í—¤ë“œ", p:560000}, {n:"SS í—¤ë“œ+í˜‘íƒ1", p:600000}, {n:"Q í—¤ë“œ+í˜‘íƒ1", p:740000}, {n:"S í—¤ë“œ+í˜‘íƒ1", p:560000}, {n:"S+S í—¤ë“œ+í˜‘íƒ1", p:800000}, {n:"SS+SS í—¤ë“œ+í˜‘íƒ1", p:880000}, {n:"SS í—¤ë“œ+í˜‘íƒ2", p:920000}, {n:"Q í—¤ë“œ+í˜‘íƒ2", p:1060000}, {n:"S í—¤ë“œ+í˜‘íƒ2", p:880000}, {n:"S+S í—¤ë“œ+í˜‘íƒ2", p:1120000}, {n:"SS+SS í—¤ë“œ+í˜‘íƒ2", p:1200000}],
        tables: [{n:"SS íŒ¨ë¸Œë¦­ í…Œì´ë¸”", p:320000}, {n:"Q íŒ¨ë¸Œë¦­ í…Œì´ë¸”", p:360000}, {n:"S+S íŒ¨ë¸Œë¦­ í…Œì´ë¸”", p:400000}],
        sets: {
            "ğŸŒ™ ì—ì„¼ì…œ ìŠ¬ë¦½": { d: 2, o: "ìŠˆë¸Œ í”„ë ˆì„ + ë§¤íŠ¸ë¦¬ìŠ¤ (Fog)", sizes: { "SS": [2041000, 1954760], "Q": [2372000, 2307320], "S+S": [3847000, 3674520], "SS+SS": [4082000, 3909520] } },
            "ğŸ’« ë¡œë§¨í‹± ìŠ¬ë¦½": { d: 3, o: "ìŠˆë¸Œ í”„ë ˆì„ + ë§¤íŠ¸ë¦¬ìŠ¤ + í—¤ë“œ + í˜‘íƒ", sizes: { "SS": [2912000, 2826640], "Q": [3279000, 3214980], "S+S": [4894000, 4723280], "SS+SS": [5204000, 5033280] } },
            "ğŸ“š ë¶ìŠ¬ë¦½ ì„¸íŠ¸": { d: 3, o: "ìŠˆë¸Œ í”„ë ˆì„ + ë§¤íŠ¸ë¦¬ìŠ¤ + í…Œì´ë¸”", sizes: { "SS": [2330000, 2244640], "Q": [2697000, 2632980], "S+S": [4195000, 4024280] } },
            "ğŸŒŸ í’€ìŠ¬ë¦½ ì„¸íŠ¸": { d: 5, o: "ìŠˆë¸Œ í”„ë ˆì„ + ë§¤íŠ¸ë¦¬ìŠ¤ + í—¤ë“œ + í˜‘íƒ + í…Œì´ë¸” + ë¬´ë“œë“±", sizes: { "SS": [3223000, 3139400], "Q": [3620000, 3557300], "S+S": [5239000, 5071800] } },
            "ğŸ’‘ ìœ„ë“œìŠ¬ë¦½ ì„¸íŠ¸": { d: 5, o: "ìŠˆë¸Œ ì»¤í”Œ í”„ë ˆì„ 2ê°œ + ë§¤íŠ¸ë¦¬ìŠ¤ 2ê°œ + í—¤ë“œ 2ê°œ + í˜‘íƒ + ë¬´ë“œë“±", sizes: { "S+S": [4859000, 4691800], "SS+SS": [4996000, 4828800] } }
        }
    }
};

function execPostcode() { new daum.Postcode({ oncomplete: function(d) { document.getElementById('custAddr').value = d.address; document.getElementById('custAddrDetail').focus(); }}).open(); }
function switchLineup(l) { currentLineup = l; document.getElementById('tab-ma').classList.toggle('active', l === 'ma'); document.getElementById('tab-shuv').classList.toggle('active', l === 'shuv'); }

function openSetModal() {
    const o = document.getElementById('modalOverlay'); const l = document.getElementById('optionList'); const t = document.getElementById('modalTitle'); const step = document.getElementById('stepIndicator');
    l.innerHTML = ''; t.innerText = "ì„¸íŠ¸ ì¢…ë¥˜ ì„ íƒ"; step.innerText = "STEP 1/3";
    const sets = data[currentLineup].sets;
    for (let setName in sets) {
        const div = document.createElement('div'); div.className = 'option-item'; div.onclick = () => selectSetSize(setName);
        div.innerHTML = `<div style="flex:1;"><div style="display:flex; align-items:center;"><span style="font-weight:bold;">${setName}</span><span class="discount-badge">${sets[setName].d}% í• ì¸</span></div><div class="set-desc">${sets[setName].o}</div></div><span style="color:#ccc;">â¯</span>`;
        l.appendChild(div);
    } o.style.display = 'flex';
}

function selectSetSize(setName) {
    const l = document.getElementById('optionList'); const t = document.getElementById('modalTitle'); const step = document.getElementById('stepIndicator');
    l.innerHTML = ''; t.innerText = `${setName} - ì‚¬ì´ì¦ˆ ì„ íƒ`; step.innerText = "STEP 2/3";
    const sizes = data[currentLineup].sets[setName].sizes;
    for (let size in sizes) {
        const div = document.createElement('div'); div.className = 'option-item'; div.onclick = () => selectSetMattress(setName, size);
        div.innerHTML = `<span>${size} ì‚¬ì´ì¦ˆ</span><span style="color:#ccc;">â¯</span>`;
        l.appendChild(div);
    }
}

function selectSetMattress(setName, size) {
    const l = document.getElementById('optionList'); const t = document.getElementById('modalTitle'); const step = document.getElementById('stepIndicator');
    l.innerHTML = ''; t.innerText = `${setName} (${size}) - ë§¤íŠ¸ë¦¬ìŠ¤ ì„ íƒ`; step.innerText = "STEP 3/3";
    const setInfo = data[currentLineup].sets[setName];
    const prices = setInfo.sizes[size];
    const types = [{ n: "í•˜ë“œ", p: prices[0] }, { n: "ë¯¸ë””ì›€ í•˜ë“œ", p: prices[1] }];
    types.forEach(type => {
        const div = document.createElement('div'); div.className = 'option-item';
        div.onclick = () => { addItem(`${setName} ${size} (${type.n})`, type.p, currentLineup, setInfo.o); closeModal(); };
        div.innerHTML = `<span>${type.n} ë§¤íŠ¸ë¦¬ìŠ¤</span><span style="color:var(--point-color); font-weight:bold;">${type.p.toLocaleString()}ì›</span>`;
        l.appendChild(div);
    });
}

function openModal(c) {
    const o = document.getElementById('modalOverlay'); const l = document.getElementById('optionList'); const t = document.getElementById('modalTitle'); const step = document.getElementById('stepIndicator');
    l.innerHTML = ''; step.innerText = ""; t.innerText = "ì˜µì…˜ ì¶”ê°€";
    let opts = c === 'mattresses' ? mattressData : (c === 'lights' ? [{n:"ë¬´ë“œë“± í•œìª½", p:35000}, {n:"ë¬´ë“œë“± ì–‘ìª½", p:70000}] : data[currentLineup][c]);
    opts.forEach(opt => {
        const div = document.createElement('div'); div.className = 'option-item'; div.onclick = () => { addItem(opt.n, opt.p, currentLineup, ""); closeModal(); };
        div.innerHTML = `<span>[${currentLineup.toUpperCase()}] ${opt.n}</span><span style="color:var(--point-color); font-weight:bold;">+${opt.p.toLocaleString()}ì›</span>`;
        l.appendChild(div);
    }); o.style.display = 'flex';
}

function closeModal() { document.getElementById('modalOverlay').style.display = 'none'; }
function addItem(n, p, b, d) { selectedItems.push({ id: Date.now(), name: `[${b === 'ma' ? 'ë§ˆë² ë“œ' : 'ìŠˆë¸Œ'}] ${n}`, price: p, brand: b, desc: d }); render(); }
function removeItem(id) { selectedItems = selectedItems.filter(i => i.id !== id); render(); }

function render() {
    const list = document.getElementById('itemList'); list.innerHTML = ''; let t = 0;
    selectedItems.forEach(i => { t += i.price; const c = i.brand === 'ma' ? 'tag-ma' : 'tag-shuv';
        list.innerHTML += `<div class="item-row"><div class="item-info"><span class="brand-tag ${c}">${i.brand === 'ma' ? 'ë§ˆë² ë“œ' : 'ìŠˆë¸Œ'}</span><span style="font-size:0.95rem; font-weight:700; display:block;">${i.name.split('] ')[1]}</span>${i.desc ? `<span class="set-desc" style="display:block; color:#7f8c8d; font-size:0.8rem; margin:2px 0 5px 0;">êµ¬ì„±: ${i.desc}</span>` : ''}<span style="font-size:0.85rem; color:#666; font-weight:bold;">${i.price.toLocaleString()}ì›</span></div><button class="btn-delete" onclick="removeItem(${i.id})">Ã—</button></div>`;
    }); document.getElementById('totalDisplay').innerText = t.toLocaleString();
}

function getSummary() {
    const n = document.getElementById('custName').value || "ë¯¸ì…ë ¥";
    const p = document.getElementById('custPhone').value || "ë¯¸ì…ë ¥";
    const a = (document.getElementById('custAddr').value + " " + document.getElementById('custAddrDetail').value).trim() || "ë¯¸ì…ë ¥";
    const m = document.getElementById('custMsg').value || "ì—†ìŒ";
    const items = selectedItems.map(i => `${i.name}${i.desc ? ` (êµ¬ì„±: ${i.desc})` : ''} - ${i.price.toLocaleString()}ì›`).join('\n');
    const total = document.getElementById('totalDisplay').innerText;
    return { n, p, a, m, items, total };
}

function copyText() {
    if(!selectedItems.length) return alert("í’ˆëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
    const s = getSummary();
    const txt = `--- ë²„í‚·ì¸  ê²¬ì  ë‚´ì—­ ---\nê³ ê°ëª…: ${s.n}\nì—°ë½ì²˜: ${s.p}\nì£¼ì†Œ: ${s.a}\nìš”ì²­ì‚¬í•­: ${s.m}\n\n[ì„ íƒí’ˆëª©]\n${s.items}\n\nì´ ê¸ˆì•¡: ${s.total}ì›`;
    const t = document.createElement("textarea"); document.body.appendChild(t); t.value = txt; t.select(); document.execCommand('copy'); document.body.removeChild(t); alert("í…ìŠ¤íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
}

async function downloadImage() {
    if(!selectedItems.length) return alert("í’ˆëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
    const s = getSummary(); const r = document.getElementById('receipt-temp');
    let h = `<div class="receipt-h"><strong style="font-size:18px;">birkits ê²¬ì ì„œ</strong><br><span style="font-size:12px; color:#666;">ë§ˆë² ë“œ & ìŠˆë¸Œ ì»¤ìŠ¤í…€ ë² ë“œ</span></div>`;
    h += `<div style="margin-bottom:20px; font-size:13px; line-height:1.5;">ê³ ê°ëª…: ${s.n}<br>ì—°ë½ì²˜: ${s.p}<br>ì£¼ì†Œ: ${s.a}</div>`;
    selectedItems.forEach(i => { h += `<div class="receipt-line"><div><span style="font-weight:bold; display:block;">${i.name}</span>${i.desc ? `<span style="font-size:11px; color:#777;">êµ¬ì„±: ${i.desc}</span>` : ''}</div><span style="white-space:nowrap; margin-left:10px;">${i.price.toLocaleString()}ì›</span></div>`; });
    h += `<div style="margin-top:20px; border-top:2px solid #333; padding-top:15px; display:flex; justify-content:space-between; font-weight:bold; font-size:18px; color:var(--point-color);"><span>ì´ í•©ê³„</span><span>${s.total}ì›</span></div>`;
    r.innerHTML = h;
    try {
        const canvas = await html2canvas(r);
        const imgData = canvas.toDataURL("image/png");
        const link = document.createElement('a');
        const d = new Date(); link.download = `ë²„í‚·ì¸ _ê²¬ì ì„œ_${d.getHours()}${d.getMinutes()}${d.getSeconds()}.png`;
        link.href = imgData; document.body.appendChild(link); link.click(); document.body.removeChild(link);
    } catch (e) { alert("ì´ë¯¸ì§€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."); }
}
</script>
</body>
</html>
